{% extends 'base.html' %}
{% load static %}
{% block title %}<title>Guest Log</title> {% endblock %}
{% block content %}
    {% if not user.is_desk_account %}
        <h3><strong>403 You do not have proper viewing permissions. </strong></h3>
    {% endif %}
    <link rel="stylesheet" href="{% static 'desklogs/css/guestlog.css' %}">
    <div id="everything">
        <div id="entry_div" data-guestlog-pk="{{ guestlog.pk }}"
             data-create-entry-url="{% url 'desklogs:ajax-create-blank-entry' %}"
             data-update-entry-url="{% url 'desklogs:ajax-update-entry' %}"
             data-checkout-entry-url="{% url 'desklogs:ajax-checkout-entry' %}">
            {% if guestlog_entries %}
                <table id="entries">
                    <tr>
                        <th>Status</th>
                        <th>Time In</th>
                        <th>Date In</th>
                        <th>Host Name</th>
                        <th>Guest Name</th>
                        <th>Time Out</th>
                        <th>Date Out</th>
                        <th>Submission</th>
                    </tr>
                    {% for entry in guestlog_entries %}
                        <tr>
                            <td class="status"
                                bgcolor="{% if entry.guest_checked_in %}green{% else %}red{% endif %}"></td>
                            <td><input type="text" class="form-control time_in"
                                       value="{% if entry.time_in %}{{ entry.time_in }}{% endif %}" disabled></td>
                            <td><input type="text" class="form-control date_in"
                                       value="{% if entry.date_in %}{{ entry.date_in }}{% endif %}" disabled></td>
                            <td><input type="text" class="form-control host_name"
                                       value="{% if entry.host_name %}{{ entry.host_name }}{% endif %}"
                                       {% if not entry.guest_checked_in %}disabled{% endif %}></td>
                            <td><input type="text" class="form-control guest_name"
                                       value="{% if entry.guest_name %}{{ entry.guest_name }}{% endif %}"
                                       {% if not entry.guest_checked_in %}disabled{% endif %}></td>
                            <td><input type="text" class="form-control time_out"
                                       value="{% if entry.time_out %}{{ entry.time_out }}{% endif %}" disabled></td>
                            <td><input type="text" class="form-control date_out"
                                       value="{% if entry.date_out %}{{ entry.date_out }}{% endif %}" disabled></td>
                            <td>
                                {% if entry.host_name and entry.guest_name and entry.guest_checked_in %}
                                    <a href="#" class="btn btn-danger checkout"
                                       data-obj-pk="{{ entry.pk }}">Checkout</a>
                                {% elif entry.guest_checked_in and not host_name and not entry.guest_name %}
                                    <a href="#" class="btn btn-success checkin" data-obj-pk="{{ entry.pk }}">Checkin</a>
                                {% else %}
                                    <a href="#" class="btn btn-secondary completed">Completed</a>
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </table>
            {% else %}
                <h3 id="no_entries">There are currently no guestlog entries in the system.</h3>
            {% endif %}
        </div>
        <div id="create_entry_button_div">
            {% if disable_creation %}
                <a href="#" class="btn btn-secondary" id="disabled_creation">Create New GuestLog Entry</a>
            {% else %}
                <a href="#" class="btn btn-success" id="create_entry_button">Create New Guestlog Entry</a>
            {% endif %}
        </div>
    </div>
    <script src="{% static 'desklogs/js/create_entry.js' %}"></script>
    <script src="{% static 'desklogs/js/disable_enter_button_submission.js' %}"></script>
    <script src="{% static 'desklogs/js/check_in.js' %}"></script>
    <script src="{% static 'desklogs/js/check_out.js' %}"></script>
{% endblock %}